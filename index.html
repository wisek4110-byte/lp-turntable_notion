<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Dynamic LP Player</title>

<style>
  body {
    margin: 0;
    display: flex;
    justify-content: center;
    font-family: system-ui, sans-serif;
    background: #f8f5ef;
  }

  /* 전체를 완전 동적크기 (부모=노션블록) */
  .lp-container {
    width: 100%;
    margin: 0;
    padding: 2vw 0 4vw;
    box-sizing: border-box;
    background: #fcfaf6;
  }

  /* LP판 비율 유지: 1:1 완전 반응형 */
  .lp-disc-wrapper {
    width: 80%;
    margin: 0 auto;
    aspect-ratio: 1/1;
    cursor: pointer;
  }

  .lp-disc {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-size: cover;
    background-position: center;
    animation: spin 3.2s linear infinite;
    animation-play-state: paused;
    box-shadow: 0 6px 12px rgba(0,0,0,0.25);
  }

  .playing .lp-disc {
    animation-play-state: running;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to   { transform: rotate(360deg); }
  }

  .track-title {
    text-align: center;
    font-size: 4vw;
    margin-top: 3vw;
    font-weight: 600;
  }

  .track-sub {
    text-align: center;
    font-size: 3vw;
    color: #777;
    margin-bottom: 4vw;
  }

  /* 컨트롤 버튼들: 크기도 반응형 */
  .controls {
    display: flex;
    justify-content: center;
    gap: 6vw;
    margin-bottom: 3vw;
  }

  .ctrl-btn {
    font-size: 5vw;
    width: 10vw;
    height: 10vw;
    border-radius: 50%;
    border: none;
    background: rgba(0,0,0,0.05);
    cursor: pointer;
    transition: 0.15s;
  }

  .ctrl-btn:hover {
    background: rgba(0,0,0,0.12);
  }

  /* 재생 버튼은 아이콘 두 개 겹쳐서 흔들림 방지 */
  .ctrl-btn.play {
    position: relative;
  }

  #icon-pause { display: none; }
  .playing #icon-play { display: none; }
  .playing #icon-pause { display: inline-block; }

  /* 재생바 */
  .progress-container {
    width: 80%;
    margin: 0 auto;
  }

  .progress-bar {
    position: relative;
    width: 100%;
    height: 1.4vw;
    background: #e2d8c6;
    border-radius: 20px;
  }

  .progress-fill {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0%;
    background: #c59c6c;
    border-radius: inherit;
    transition: width 0.15s linear;
  }

  .progress-knob {
    position: absolute;
    top: 50%;
    width: 3vw;
    height: 3vw;
    border-radius: 50%;
    background: #fff;
    box-shadow: 0 0 4px rgba(0,0,0,0.4);
    transform: translate(-50%, -50%);
  }

  .time-info {
    width: 80%;
    margin: 1vw auto 0;
    display: flex;
    justify-content: space-between;
    font-size: 3vw;
    color: #777;
  }
</style>
</head>
<body>

<div class="lp-container" id="lp-container">

  <!-- LP판 -->
  <div class="lp-disc-wrapper" id="lp-disc-area">
    <div class="lp-disc" id="lp-disc"></div>
  </div>

  <div class="track-title" id="track-title">Track 1</div>
  <div class="track-sub" id="track-sub">LP Playlist</div>

  <!-- 컨트롤 -->
  <div class="controls">
    <button class="ctrl-btn" id="btn-prev">⏮</button>
    <button class="ctrl-btn play" id="btn-play">
      <span id="icon-play">▶</span>
      <span id="icon-pause">⏸</span>
    </button>
    <button class="ctrl-btn" id="btn-next">⏭</button>
  </div>

  <!-- 재생바 -->
  <div class="progress-container">
    <div class="progress-bar" id="progress-bar">
      <div class="progress-fill" id="progress-fill"></div>
      <div class="progress-knob" id="progress-knob"></div>
    </div>
  </div>

  <div class="time-info">
    <span id="time-current">0:00</span>
    <span id="time-total">0:00</span>
  </div>

  <div id="player"></div>

</div>

<script>
  /* --- YouTube API Load --- */
  var tag = document.createElement("script");
  tag.src = "https://www.youtube.com/iframe_api";
  document.body.appendChild(tag);

  /* --- 플레이리스트 데이터 --- */
  var playlist = [
    "kAAcl3nIe24",
    "9uxYuIpvsjw",
    "iv9rmTEaECw"
  ];

  var discImages = [
    "lp1.png",
    "lp2.png",
    "lp3.png"
  ];

  var trackTitles = [
    "Track 1",
    "Track 2",
    "Track 3"
  ];

  var currentIndex = 0;
  var player;
  var startedOnce = false;
  var updateTimer = null;

  const lpCont = document.getElementById("lp-container");
  const lpDisc = document.getElementById("lp-disc");
  const lpDiscArea = document.getElementById("lp-disc-area");

  const btnPlay = document.getElementById("btn-play");
  const btnPrev = document.getElementById("btn-prev");
  const btnNext = document.getElementById("btn-next");

  const progressFill = document.getElementById("progress-fill");
  const progressKnob = document.getElementById("progress-knob");

  const timeCurrent = document.getElementById("time-current");
  const timeTotal = document.getElementById("time-total");

  const trackTitleEl = document.getElementById("track-title");
  const trackSubEl = document.getElementById("track-sub");

  function updateVisual(){
    lpDisc.style.backgroundImage = `url(${discImages[currentIndex]})`;
    trackTitleEl.textContent = trackTitles[currentIndex];
    trackSubEl.textContent = `LP Playlist • ${currentIndex+1}/${playlist.length}`;
    progressFill.style.width = "0%";
    progressKnob.style.left = "0%";
    timeCurrent.textContent = "0:00";
    timeTotal.textContent = "0:00";
  }

  function onYouTubeIframeAPIReady() {
    player = new YT.Player("player", {
      videoId: playlist[0],
      height: "0",
      width: "0",
      playerVars: {
        autoplay: 0,
        controls: 0
      },
      events: {
        onReady: onPlayerReady,
        onStateChange: onStateChange
      }
    });
  }

  function onPlayerReady(){
    updateVisual();

    lpDiscArea.addEventListener("click", () => togglePlay());
    lpDiscArea.addEventListener("dblclick", nextTrack);

    btnPlay.addEventListener("click", togglePlay);
    btnPrev.addEventListener("click", prevTrack);
    btnNext.addEventListener("click", nextTrack);
  }

  function togglePlay(){
    if(!startedOnce){
      playCurrent();
      return;
    }
    let state = player.getPlayerState();
    if(state === YT.PlayerState.PLAYING){
      player.pauseVideo();
      lpCont.classList.remove("playing");
    } else {
      player.playVideo();
      lpCont.classList.add("playing");
    }
  }

  function playCurrent(){
    startedOnce = true;
    updateVisual();
    player.loadVideoById(playlist[currentIndex]);
    player.playVideo();
    lpCont.classList.add("playing");
    startBar();
  }

  function nextTrack(){
    currentIndex = (currentIndex+1) % playlist.length;
    playCurrent();
  }

  function prevTrack(){
    currentIndex = (currentIndex-1+playlist.length)%playlist.length;
    playCurrent();
  }

  function onStateChange(e){
    if(e.data === YT.PlayerState.PLAYING){
      lpCont.classList.add("playing");
      startBar();
    }
    if(e.data === YT.PlayerState.PAUSED){
      lpCont.classList.remove("playing");
    }
    if(e.data === YT.PlayerState.ENDED){
      nextTrack();
    }
  }

  function startBar(){
    if(updateTimer) clearInterval(updateTimer);

    updateTimer = setInterval(()=>{
      let cur = player.getCurrentTime();
      let dur = player.getDuration();

      timeCurrent.textContent = format(cur);
      timeTotal.textContent = format(dur);

      let percent = (cur/dur)*100;
      progressFill.style.width = percent+"%";
      progressKnob.style.left = percent+"%";
    },300);
  }

  function format(sec){
    sec = Math.floor(sec);
    let m = Math.floor(sec/60);
    let s = sec%60;
    return m+":"+(s<10?"0"+s:s);
  }
</script>

</body>
</html>
